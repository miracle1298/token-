<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token Launcher - Farcaster Mini App</title>
  <meta name="description" content="Create your own token in seconds on Farcaster">
  <meta property="fc:frame" content="vNext">
  <meta property="fc:frame:image" content="https://token-ten-pink.vercel.app/preview.svg">
  <meta property="og:image" content="https://token-ten-pink.vercel.app/preview.svg">
  <meta property="og:title" content="Token Launcher">
  <meta property="og:description" content="Create your own token in seconds">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  </style>
  </head>
<body>
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    function TokenLauncher() {
      const [step, setStep] = useState('form');
      const [tokenName, setTokenName] = useState('');
      const [ticker, setTicker] = useState('');
      const [image, setImage] = useState(null);
      const [imagePreview, setImagePreview] = useState(null);
      const [launchedToken, setLaunchedToken] = useState(null);
      const [tokens, setTokens] = useState([]);
      const [stats, setStats] = useState({});
      const [account, setAccount] = useState('');
      const [chain, setChain] = useState('');
      const [claiming, setClaiming] = useState({});
      const [claimed, setClaimed] = useState({});
      useEffect(() => {
        try {
          const raw = localStorage.getItem('launchedTokens');
          if (raw) setTokens(JSON.parse(raw));
        } catch {}
      }, []);
      useEffect(() => {
        async function autoConnect() {
          try {
            if (!window.ethereum || !ethers) return;
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            try {
              const accounts = await provider.listAccounts();
              if (!accounts || accounts.length === 0) {
                await provider.send('eth_requestAccounts', []);
                const accs = await provider.listAccounts();
                if (accs && accs.length) setAccount(accs[0]);
              } else {
                setAccount(accounts[0]);
              }
            } catch {}
            try {
              const network = await provider.getNetwork();
              if (network.chainId !== 8453) {
                await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x2105' }] });
                setChain('Base');
              } else {
                setChain('Base');
              }
            } catch {}
            try {
              window.ethereum.removeListener && window.ethereum.removeListener('accountsChanged', () => {});
              window.ethereum.on && window.ethereum.on('accountsChanged', (accs) => { setAccount(accs && accs.length ? accs[0] : ''); });
              window.ethereum.on && window.ethereum.on('chainChanged', (hex) => { setChain(hex === '0x2105' ? 'Base' : hex); });
            } catch {}
          } catch {}
        }
        autoConnect();
      }, []);
      useEffect(() => {
        try {
          localStorage.setItem('launchedTokens', JSON.stringify(tokens));
        } catch {}
      }, [tokens]);

      useEffect(() => {
        async function load() {
          const list = tokens || [];
          const adds = list.map(t => t.address);
          const tasks = adds.map(async (addr) => {
            try {
              const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);
              const data = await res.json();
              const pairs = Array.isArray(data?.pairs) ? data.pairs : [];
              const basePairs = pairs.filter(p => (p?.chainId === 'base' || (p?.chainSymbol && p.chainSymbol.toUpperCase() === 'BASE')));
              const sorted = basePairs.sort((a,b)=>((b?.liquidity?.usd||0)-(a?.liquidity?.usd||0)));
              const best = sorted[0];
              if (best) {
                setStats(prev => ({...prev, [addr]: {
                  priceUsd: best.priceUsd ? parseFloat(best.priceUsd) : null,
                  fdv: best.fdv ?? null,
                  liquidityUsd: best?.liquidity?.usd ?? null,
                  url: best.url ?? null,
                  chainId: best.chainId ?? 'base'
                }}));
              } else {
                setStats(prev => ({...prev, [addr]: {}}));
              }
            } catch {
              setStats(prev => ({...prev, [addr]: {}}));
            }
          });
          await Promise.all(tasks);
        }
        if (step === 'dashboard') {
          load();
          const id = setInterval(load, 30000);
          return () => clearInterval(id);
        }
      }, [step, tokens]);
      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          setImage(file);
          const reader = new FileReader();
          reader.onloadend = () => { setImagePreview(reader.result); };
          reader.readAsDataURL(file);
        }
      };
      const launchToken = async () => {
        if (!tokenName || !ticker) { alert('Please enter token name and ticker'); return; }
        setStep('launching');
        setTimeout(() => {
          const mockToken = {
            name: tokenName,
            ticker: ticker.toUpperCase(),
            address: '0x' + Math.random().toString(16).slice(2).padEnd(40, '0'),
            marketCap: Math.floor(Math.random() * 50000) + 10000,
            image: imagePreview,
            creatorFee: '40%'
          };
          setLaunchedToken(mockToken);
          setTokens(prev => [...prev, mockToken]);
          setStep('success');
        }, 2500);
      };
      const reset = () => {
        setStep('form');
        setTokenName('');
        setTicker('');
        setImage(null);
        setImagePreview(null);
        setLaunchedToken(null);
      };
      const shareToken = () => {
        const shareText = `ðŸš€ Just launched ${launchedToken.ticker} on Farcaster!\n\nToken: ${launchedToken.name}\nMarket Cap: $${launchedToken.marketCap.toLocaleString()}\n\nCheck it out and start trading! ðŸ’°`;
        const farcasterShareUrl = `https://warpcast.com/~/compose?text=${encodeURIComponent(shareText)}`;
        try { window.open(farcasterShareUrl, '_blank'); }
        catch (e) { navigator.clipboard.writeText(shareText).then(() => alert('Share text copied!')).catch(() => alert(`Copy: ${shareText}`)); }
      };
      const claimFees = async (addr) => {
        try {
          if (!window.ethereum || !ethers) { alert('Please install a wallet to claim'); return; }
          setClaiming(prev => ({...prev, [addr]: true}));
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send('eth_requestAccounts', []);
          const network = await provider.getNetwork();
          if (network.chainId !== 8453) {
            try {
              await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x2105' }] });
            } catch (e) {
              alert('Switch your wallet to Base');
              setClaiming(prev => ({...prev, [addr]: false}));
              return;
            }
          }
          const signer = provider.getSigner();
          const abi1 = [ 'function claimCreatorFees()' ];
          const abi2 = [ 'function claimFees()' ];
          let tx;
          try {
            const c1 = new ethers.Contract(addr, abi1, signer);
            tx = await c1.claimCreatorFees();
          } catch (e1) {
            const c2 = new ethers.Contract(addr, abi2, signer);
            tx = await c2.claimFees();
          }
          const receipt = await tx.wait();
          setClaimed(prev => ({...prev, [addr]: receipt.transactionHash}));
          alert('Creator fees claimed');
        } catch (e) {
          alert('Unable to claim fees');
        } finally {
          setClaiming(prev => ({...prev, [addr]: false}));
        }
      };
      if (step === 'launching') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-500 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl shadow-2xl p-12 max-w-md w-full text-center">
              <div className="flex justify-center mb-6">
                <div className="animate-spin">
                  <svg className="w-20 h-20 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                </div>
              </div>
              <h2 className="text-3xl font-bold text-gray-800 mb-4">Launching Token...</h2>
              <p className="text-gray-600 mb-6">Deploying {ticker.toUpperCase()} to Base blockchain</p>
              <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div className="bg-gradient-to-r from-purple-600 to-cyan-500 h-full rounded-full animate-pulse" style={{width: '70%'}}></div>
              </div>
            </div>
          </div>
        );
      }
      if (step === 'success') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-500 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
              <div className="text-center mb-6">
                <div className="flex justify-center mb-4">
                  <div className="bg-green-100 rounded-full p-4">
                    <svg className="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                  </div>
                </div>
                <h2 className="text-3xl font-bold text-gray-800 mb-2">Token Launched! ðŸŽ‰</h2>
                <p className="text-gray-600">Your token is now live on Base</p>
              </div>
              <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-6 mb-6">
                {launchedToken.image && <div className="flex justify-center mb-4"><img src={launchedToken.image} alt="Token" className="w-20 h-20 rounded-full border-4 border-white shadow-lg" /></div>}
                <div className="text-center mb-4">
                  <h3 className="text-2xl font-bold text-gray-800">{launchedToken.name}</h3>
                  <p className="text-xl text-purple-600 font-bold">${launchedToken.ticker}</p>
                </div>
                <div className="space-y-3 text-sm">
                  <div className="flex justify-between items-center"><span className="text-gray-600">Contract:</span><span className="text-gray-800 font-mono text-xs">{launchedToken.address.slice(0, 8)}...{launchedToken.address.slice(-6)}</span></div>
                  <div className="flex justify-between items-center"><span className="text-gray-600">Market Cap:</span><span className="text-green-600 font-bold">${launchedToken.marketCap.toLocaleString()}</span></div>
                  <div className="flex justify-between items-center"><span className="text-gray-600">Your Creator Fee:</span><span className="text-purple-600 font-bold">{launchedToken.creatorFee}</span></div>
                </div>
              </div>
              <div className="space-y-3">
                <button onClick={shareToken} className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-4 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all">Share on Farcaster</button>
                <button onClick={reset} className="w-full bg-white border-2 border-purple-200 text-purple-700 font-bold py-4 rounded-xl hover:border-purple-300 transition-all">Launch Another Token</button>
                <button onClick={() => setStep('dashboard')} className="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-4 rounded-xl hover:from-green-700 hover:to-teal-700 transition-all">View Dashboard</button>
                <button disabled={claiming[launchedToken?.address]} onClick={() => claimFees(launchedToken.address)} className="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white font-bold py-4 rounded-xl hover:from-orange-700 hover:to-red-700 transition-all">Claim Creator Fees</button>
              </div>
            </div>
          </div>
        );
      }
      if (step === 'dashboard') {
        const copyAddress = (addr) => {
          navigator.clipboard.writeText(addr).then(() => alert('Address copied')).catch(() => alert(addr));
        };
        const share = (t) => {
          const shareText = `ðŸš€ Just launched ${t.ticker} on Farcaster!\n\nToken: ${t.name}\nMarket Cap: $${t.marketCap.toLocaleString()}\n\nCheck it out and start trading! ðŸ’°`;
          const url = `https://warpcast.com/~/compose?text=${encodeURIComponent(shareText)}`;
          try { window.open(url, '_blank'); } catch (e) { navigator.clipboard.writeText(shareText).then(() => alert('Share text copied')).catch(() => alert(shareText)); }
        };
        const addByAddress = async () => {
          const input = document.getElementById('add-address-input');
          const addr = (input?.value || '').trim();
          if (!/^0x[0-9a-fA-F]{40}$/.test(addr)) { alert('Enter a valid 0x contract address'); return; }
          const exists = tokens.find(t => t.address.toLowerCase() === addr.toLowerCase());
          if (exists) { alert('Address already tracked'); return; }
          try {
            const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);
            const data = await res.json();
            const pairs = Array.isArray(data?.pairs) ? data.pairs : [];
            const basePairs = pairs.filter(p => (p?.chainId === 'base' || (p?.chainSymbol && p.chainSymbol.toUpperCase() === 'BASE')));
            if (!basePairs.length) { alert('Token not detected on Base'); return; }
          } catch {}
          const newToken = { name: 'Custom Token', ticker: 'TOKEN', address: addr, marketCap: 0, image: null, creatorFee: '0%' };
          setTokens(prev => [...prev, newToken]);
          if (input) input.value = '';
        };
        const removeToken = (addr) => {
          setTokens(prev => prev.filter(t => t.address.toLowerCase() !== addr.toLowerCase()));
        };
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-500 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-gray-800">Your Tokens</h2>
                <div className="space-x-2 flex items-center">
                  <span className="hidden md:inline px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">{chain || 'â€”'}</span>
                  <span className="hidden md:inline font-mono text-gray-700 text-xs">{account ? `${account.slice(0,6)}...${account.slice(-4)}` : 'Not connected'}</span>
                  <button onClick={() => setStep('form')} className="px-4 py-2 bg-white border-2 border-purple-200 text-purple-700 rounded-xl hover:border-purple-300 transition-all">Launch New</button>
                  <button onClick={() => { setTokens([]); localStorage.removeItem('launchedTokens'); }} className="px-4 py-2 bg-white border-2 border-red-200 text-red-600 rounded-xl hover:border-red-300 transition-all">Clear All</button>
                </div>
              </div>
              <div className="flex items-center gap-2 mb-6">
                <input id="add-address-input" type="text" placeholder="0x... contract address" className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors text-gray-800" />
                <button onClick={addByAddress} className="px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl">Add</button>
              </div>
              {tokens.length === 0 ? (
                <div className="text-center text-gray-600">No tokens yet</div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {tokens.map((t, i) => (
                    <div key={i} className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-6 shadow">
                      <div className="flex items-center mb-4">
                        {t.image ? (
                          <img src={t.image} alt="Token" className="w-12 h-12 rounded-full border-2 border-white shadow mr-3" />
                        ) : (
                          <div className="w-12 h-12 rounded-full bg-purple-200 mr-3" />
                        )}
                        <div>
                          <div className="text-lg font-bold text-gray-800">{t.name}</div>
                          <div className="text-purple-600 font-bold">${t.ticker}</div>
                        </div>
                      </div>
                      <div className="space-y-2 text-sm">
                        <div className="flex justify-between"><span className="text-gray-600">Contract</span><span className="text-gray-800 font-mono text-xs">{t.address.slice(0,8)}...{t.address.slice(-6)}</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">Market Cap</span><span className="text-green-600 font-bold">${t.marketCap.toLocaleString()}</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">Price</span><span className="text-gray-800 font-bold">{stats[t.address]?.priceUsd ? `$${stats[t.address].priceUsd.toFixed(6)}` : 'â€”'}</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">Liquidity</span><span className="text-gray-800">{stats[t.address]?.liquidityUsd ? `$${Math.round(stats[t.address].liquidityUsd).toLocaleString()}` : 'â€”'}</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">FDV</span><span className="text-gray-800">{stats[t.address]?.fdv ? `$${Math.round(stats[t.address].fdv).toLocaleString()}` : 'â€”'}</span></div>
                        <div className="flex justify-between"><span className="text-gray-600">Network</span><span className="text-gray-800">{stats[t.address]?.chainId ? stats[t.address].chainId : 'â€”'}</span></div>
                        {!stats[t.address]?.liquidityUsd && (<div className="text-xs text-yellow-700">No Base liquidity yet</div>)}
                      </div>
                      <div className="mt-4 space-x-2">
                        <button onClick={() => share(t)} className="px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl">Share</button>
                        <button onClick={() => copyAddress(t.address)} className="px-3 py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-xl">Copy Address</button>
                        {stats[t.address]?.url && (<a href={stats[t.address].url} target="_blank" rel="noreferrer" className="px-3 py-2 bg-white border-2 border-blue-200 text-blue-700 rounded-xl">Chart</a>)}
                        <button disabled={claiming[t.address]} onClick={() => claimFees(t.address)} className="px-3 py-2 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-xl">Claim Fees</button>
                        <button onClick={() => removeToken(t.address)} className="px-3 py-2 bg-white border-2 border-red-200 text-red-600 rounded-xl">Remove</button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }
      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-cyan-500 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
            <div className="flex justify-between items-center mb-4">
              <div className="flex items-center gap-2 text-xs">
                <span className="px-2 py-1 bg-green-100 text-green-700 rounded-full">{chain || 'â€”'}</span>
                <span className="font-mono text-gray-700">{account ? `${account.slice(0,6)}...${account.slice(-4)}` : 'Not connected'}</span>
              </div>
              <button onClick={() => setStep('dashboard')} className="px-4 py-2 bg-white border-2 border-purple-200 text-purple-700 rounded-xl hover:border-purple-300 transition-all">Open Dashboard</button>
            </div>
            <div className="text-center mb-8">
              <div className="flex justify-center mb-4">
                <div className="bg-gradient-to-r from-purple-600 to-cyan-500 rounded-full p-4">
                  <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
              </div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">Token Launcher</h1>
              <p className="text-gray-600">Create your token in seconds</p>
            </div>
            <div className="space-y-6">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Token Name</label>
                <input type="text" value={tokenName} onChange={(e) => setTokenName(e.target.value)} placeholder="e.g., Moon Rocket" className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors text-gray-800" maxLength={30} />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Ticker Symbol</label>
                <input type="text" value={ticker} onChange={(e) => setTicker(e.target.value.toUpperCase())} placeholder="e.g., MOON" className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors text-gray-800 font-bold" maxLength={6} />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Token Image (Optional)</label>
                <div className="relative">
                  <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" id="image-upload" />
                  <label htmlFor="image-upload" className="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-purple-500 cursor-pointer text-gray-600">Upload Image</label>
                  {imagePreview && <div className="flex justify-center mt-4"><img src={imagePreview} alt="Token" className="w-24 h-24 rounded-full border-4 border-white shadow-lg" /></div>}
                </div>
              </div>
              <button onClick={launchToken} className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-4 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all">Launch Token</button>
            </div>
          </div>
        </div>
      );
    }
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TokenLauncher />);
  </script>
</body>
</html>

